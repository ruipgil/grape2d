'use strict';var Grape2D={vernum:0,version:""};
(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var e=(new Date).getTime(),g=Math.max(0,16-(e-a)),h=window.setTimeout(function(){b(e+g)},g);a=e+g;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();Grape2D.utils={getDocumentSize:function(){return{width:document.width||document.documentElement.clientWidth,height:document.height||document.documentElement.clientHeight}}};Grape2D.utils.Clock=function(){this.frameCount=0;this.lastFrame=this.end=this.start=(new Date).getTime();this.timeEl=this.fps=0};
Grape2D.utils.Clock.prototype={constructor:Grape2D.utils.Clock,update:function(){var a=(new Date).getTime(),b=a-this.lastFrame;this.frameCount++;this.timeEl++;1E3<=this.timeEl&&this.reset(a);this.lastFrame=a;return b},reset:function(a){this.fps=this.frameCount;this.frameCount=this.timeEl=0;this.end=a}};
Grape2D.Math={PI:3.141592653589793,PIx2:6.283185307179586,PId2:1.5707963267948966,PId4:0.7853981633974483,PId6:0.5235987755982988,PId8:0.39269908169872414,abs:function(a){return Math.abs(a)},floor:function(a){return~~a},ceil:function(a){return Math.ceil(a)},round:function(a){return~~(a+0.5)},randFloat:function(a,b){return b?a+Math.random()*(b-a):Math.random()*a},randInt:function(a,b){return Grape2D.Math.floor(Grape2D.Math.randFloat(a,b)+0.5)},cos:Math.cos,sin:Math.sin,tan:Math.tan,sqrt:Math.sqrt,
clamp:function(a,b,c){return a<b?b:a>c?c:a},overlaps:function(a,b){return a.min<=b.min?a.max-b.min:Grape2D.Math.overlaps(b,a)},sq:function(a){return a*a}};Grape2D.Vector=function(a,b){this.x=a||0;this.y=b||0};
Grape2D.Vector.prototype={constructor:Grape2D.Vector,getX:function(){return this.x},setX:function(a){this.x=a},getY:function(){return this.y},setY:function(a){this.y=a},set:function(a){this.x=a.x;this.y=a.y;return this},add:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyByScalar:function(a){this.x*=a;this.y*=a;return this},divideByScalar:function(a){this.x/=a;this.y/=a;return this},negate:function(){return this.multiplyByScalar(-1)},normalize:function(){return this.divideByScalar(this.getMagnitude())},
getMagnitude:function(){return Grape2D.Math.sqrt(this.x*this.x+this.y*this.y)},length:function(){return this.getMagnitude()},lengthSquared:function(){return this.x*this.x+this.y*this.y},getAngle:function(){var a=1;0>this.y&&(a=-1);return Math.acos(this.x/this.length())*a},dot:function(a){return this.x*a.x+this.y*a.y},project:function(a){var b=this.dot(a),c=new Grape2D.Vector;c.x=b*a.x;c.y=b*a.y;return c},rightNormal:function(){return new Grape2D.Vector(-this.y,this.x)},isParallelTo:function(a){return Grape2D.Math.abs(a.x)==
Grape2D.Math.abs(this.x)&&Grape2D.Math.abs(a.y)==Grape2D.Math.abs(this.x)},distanceTo:function(a){return Grape2D.Math.sqrt(a.x*this.x+a.y*this.y)},sqDistanceTo:function(a){return a.x*this.x+a.y*this.y},equals:function(a){return this.x==a.x&&this.y==a.y},clone:function(){return new Grape2D.Vector(this.x,this.y)},toString:function(){return"Grape2D.Vector ("+this.x+","+this.y+")"},use:function(a){this.x=a(this.x);this.y=a(this.y);return this}};
Grape2D.Vector.createFromPoints=function(a,b){return new Grape2D.Vector(b.x-a.x,b.y-a.y)};Grape2D.Vector.createFromAngle=function(a,b){return new Grape2D.Vector(b*Grape2D.Math.cos(a),b*Grape2D.Math.sin(a))};Grape2D.Matrix=function(a,b,c,d,f,e,g,h,k){this.v=[];void 0!==a?this.v=[a,b,c,d,f,e,g,h,k]:this.identity()};
Grape2D.Matrix.prototype={constructor:Grape2D.Matrix,set:function(a,b,c,d,f,e,g,h,k){a=this.v;a[0]=a[4]=a[8]=1;a[1]=a[2]=a[3]=a[5]=a[6]=a[7]=0;return this},add:function(a){for(var b=0;9>b;b++)this.v[b]+=a.v[b];return this},identity:function(){this.v=[1,0,0,0,1,0,0,0,1];return this},invert:function(){var a=this.determinant(),b=this.v;this.v=[b[4]*b[8]-b[5]*b[7],b[2]*b[7]-b[1]*b[8],b[1]*b[5]-b[2]*b[4],b[5]*b[6]-b[8]*b[3],b[0]*b[8]-b[2]*b[6],b[2]*b[3]-b[0]*b[5],b[3]*b[7]-b[4]*b[6],b[1]*b[6]-b[0]*b[7],
b[0]*b[4]-b[1]*b[3]];return this.multiplyByScalar(1/a)},determinant:function(){var a=this.v;return a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6])},multiplyByVector:function(a){return new Grape2D.Vector(this.v[0]*a.x+this.v[1]*a.y+this.v[2],this.v[3]*a.x+this.v[4]*a.y+this.v[5])},multiplyByScalar:function(a){this.v[0]*=a;this.v[1]*=a;this.v[2]*=a;this.v[3]*=a;this.v[4]*=a;this.v[5]*=a;this.v[6]*=a;this.v[7]*=a;this.v[8]*=a;return this},multiplyByMatrix:function(a){var b=
this.v;a=a.v;return new Grape2D.Matrix(b[0]*a[0]+b[1]*a[3]+b[2]*a[6],b[0]*a[1]+b[1]*a[4]+b[2]*a[7],b[0]*a[2]+b[1]*a[5]+b[2]*a[8],b[3]*a[0]+b[4]*a[3]+b[5]*a[6],b[3]*a[1]+b[4]*a[4]+b[5]*a[7],b[3]*a[2]+b[4]*a[5]+b[5]*a[8],b[6]*a[0]+b[7]*a[3]+b[8]*a[6],b[6]*a[1]+b[7]*a[4]+b[8]*a[7],b[6]*a[2]+b[7]*a[5]+b[8]*a[8])},transpose:function(){var a,b=this.v;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},clone:function(){return new Grape2D.Matrix(this.v[0],this.v[1],this.v[2],
this.v[3],this.v[4],this.v[5],this.v[6],this.v[7],this.v[8])},toString:function(){return"Grape2D.Matrix\n"+this.v[0]+" "+this.v[1]+" "+this.v[2]+"\n"+this.v[3]+" "+this.v[4]+" "+this.v[5]+"\n"+this.v[6]+" "+this.v[7]+" "+this.v[8]}};Grape2D.Renderer=function(){};
Grape2D.Renderer.prototype={constructor:Grape2D.Renderer,getWidth:function(){},getHalfWidth:function(){},setWidth:function(a){},getHeight:function(){},getHalfHeight:function(){},setHeight:function(a){},renderTexture:function(a,b){},renderObject2D:function(a,b){},renderImage:function(a,b,c,d,f,e,g,h,k){},renderAABB:function(a,b){},renderCircle:function(a,b){},renderPolygon:function(a,b){},renderText:function(a,b){},start:function(){},end:function(){},appendToDOMElement:function(a){},getDOMElement:function(){},
setStrokeColor:function(a){},setFillColor:function(a){}};Grape2D.Canvas=function(a){a||(a={});this.canvas=document.createElement("Canvas");this.canvas.width=a.width||300;this.canvas.height=a.height||150;this.halfWidth=this.canvas.width/2;this.halfHeight=this.canvas.height/2;this.context=this.canvas.getContext("2D")};
Grape2D.Canvas.prototype={getWidth:function(){return this.canvas.width},getHalfWidth:function(){return this.halfWidth},setWidth:function(a){this.canvas.width=a;this.halfWidth=a/2},getHeight:function(){return this.height},getHalfHeight:function(){return this.halfHeight},setHeight:function(a){this.canvas.height=a;this.halfHeight=a/2},toDataURL:function(a,b){return this.canvas.toDataURL(a,b)},getContext:function(){return this.context},save:function(){this.context.save();return this},restore:function(){this.context.restore();
return this},scale:function(a,b){this.context.scale(a,b);return this},rotate:function(a){this.context.rotate(a);return this},translate:function(a,b){this.context.translate(a,b);return this},transform:function(a,b,c,d,f,e){this.context.transform(a,b,c,d,f,e);return this},drawImage:function(a,b,c,d,f,e,g,h,k){this.context.drawImage(a,b,c,d,f,e,g,h,k);return this},setGlobalAlpha:function(a){this.context.globalAlpha=a;return this},globalCompositeOperation:function(a){this.context.globalCompositeOperation=
a;return this},setLineWidth:function(a){this.context.lineWidth=a;return this},setLineCap:function(a){this.context.lineCap=a;return this},setLineJoin:function(a){this.context.lineJoin=a;return this},setMiterLimit:function(a){this.context.miterLimit=a;return this},setStrokeStyle:function(a){this.context.strokeStyle=a;return this},setFillStyle:function(a){this.context.fillStyle=a;return this},setShadowOffsetX:function(a){this.context.shadowOffsetX=a;return this},setShadowOffsetY:function(a){this.context.shadowOffsetY=
a;return this},setShadowBlur:function(a){this.context.shadowBlur=a;return this},setShadowColor:function(a){this.context.shadowColor=a;return this},createLinearGradient:function(a,b,c,d){return this.context.createLinearGradient(a,b,c,d)},createRadialGradient:function(a,b,c,d,f,e){return this.context.createRadialGradient(a,b,c,d,f,e)},createPattern:function(a,b){return this.context.createPattern(a,b)},beginPath:function(){this.context.beginPath();return this},closePath:function(){this.context.closePath();
return this},fill:function(){this.context.fill();return this},stroke:function(){this.context.stroke();return this},clip:function(){this.context.clip();return this},moveTo:function(a,b){this.context.moveTo(a,b);return this},lineTo:function(a,b){this.context.lineTo(a,b);return this},quadraticCurveTo:function(a,b,c,d){this.context.quadraticCurveTo(a,b,c,d);return this},bezierCurveTo:function(a,b,c,d,f,e){this.context.bezierCurveTo(a,b,c,d,f,e);return this},arcTo:function(a,b,c,d,f){this.context.arcTo(a,
b,c,d,f);return this},arc:function(a,b,c,d,f,e){this.context.arc(a,b,c,d||0,f||Grape2D.Math.PIx2,e||!1);return this},rect:function(a,b,c,d){this.context.rect(a,b,c,d);return this},isPointInPath:function(a,b){return this.context.isPointInPath(a,b)},setFont:function(a){this.context.font=a;return this},setTextAlign:function(a){this.context.textAlign=a;return this},setTextBaseline:function(a){this.context.textBaseline=a;return this},fillText:function(a,b,c){this.context.fillText(a,b,c);return this},strokeText:function(a,
b,c){this.context.strokeText(a,b,c);return this},measureText:function(a){return this.context.measureText(a)},clearRect:function(a,b,c,d){this.context.clearRect(a,b,c,d);return this},fillRect:function(a,b,c,d){this.context.fillRect(a,b,c,d);return this},strokeRect:function(a,b,c,d){this.context.strokeRect(a,b,c,d);return this},createImageData:function(a,b){return this.context.createImageData(a,b)},getImageData:function(a,b,c,d){return this.context.getImageData(a,b,c,d)},putImageData:function(a,b,c,
d,f,e,g){this.context.putImageData(a,b,c,d,f,e,g);return this},resize:function(a,b){this.setWidth(a);this.setHeight(b);return this},appendOn:function(a){a.appendChild(this.canvas);return this},clear:function(){this.context.clearRect(0,0,this.width,this.height)}};Grape2D.CanvasRenderer=function(a){this.canvas=new Grape2D.Canvas(a)};Grape2D.CanvasRenderer.prototype=Object.create(Grape2D.Renderer.prototype);Grape2D.CanvasRenderer.prototype.getWidth=function(){return this.canvas.getWidth()};
Grape2D.CanvasRenderer.prototype.getHalfWidth=function(){return this.canvas.getHalfWidth()};Grape2D.CanvasRenderer.prototype.setWidth=function(a){this.canvas.setWidth(a)};Grape2D.CanvasRenderer.prototype.getHeight=function(){return this.canvas.getHeight()};Grape2D.CanvasRenderer.prototype.getHalfHeight=function(){return this.canvas.getHalfHeight()};Grape2D.CanvasRenderer.prototype.setHeight=function(a){this.canvas.setHeight(a)};
Grape2D.CanvasRenderer.prototype.renderTexture=function(a,b){this.canvas.drawImage(a.getBuffer(),0,0,a.getWidth(),a.getHeight(),b.getX(),b.getY(),1*a.getWidth(),1*a.getHeight())};Grape2D.CanvasRenderer.prototype.renderObject2D=function(a,b){a.getTexture().render(this,b.wcsToViewport(this,a.getTexturePosition()))};Grape2D.CanvasRenderer.prototype.renderImage=function(a,b,c,d,f,e,g,h,k){this.canvas.drawImage(a,b,c,d,f,e,g,h,k)};
Grape2D.CanvasRenderer.prototype.renderAABB=function(a,b){var c=a.getPosition().clone(),d=c.clone(),f=c.clone(),e=c.clone();d.x-=a.getHalfWidth();d.y-=a.getHalfHeight();d=b.wcsToViewport(this,d);f.x+=a.getHalfWidth();f.y-=a.getHalfHeight();f=b.wcsToViewport(this,f);c.x-=a.getHalfWidth();c.y+=a.getHalfHeight();c=b.wcsToViewport(this,c);e.x+=a.getHalfWidth();e.y+=a.getHalfHeight();e=b.wcsToViewport(this,e);this.canvas.beginPath();this.canvas.moveTo(d.x,d.y);this.canvas.lineTo(f.x,f.y);this.canvas.lineTo(e.x,
e.y);this.canvas.lineTo(c.x,c.y);this.canvas.lineTo(d.x,d.y);this.canvas.stroke()};Grape2D.CanvasRenderer.prototype.renderCircle=function(a,b){var c=b.wcsToViewport(this,a.getPosition());this.canvas.beginPath();this.canvas.arc(c.x,c.y,a.getRadius(),0,Grape2D.Math.PIx2,!1);this.canvas.stroke()};
Grape2D.CanvasRenderer.prototype.renderPolygon=function(a,b){var c=a.getPosition(),d=null,f=c.clone(),e=a.getVertexList(),f=b.wcsToViewport(this,f.add(e[0]));this.canvas.beginPath();this.canvas.moveTo(f.getX(),f.getY());for(var g=1;g<e.length;g++)d=c.clone(),d=b.wcsToViewport(this,d.add(e[g])),this.canvas.lineTo(d.getX(),d.getY());this.canvas.lineTo(f.getX(),f.getY());this.canvas.stroke()};Grape2D.CanvasRenderer.prototype.renderText=function(a,b){this.canvas.strokeText(a,b.getX(),b.getY())};
Grape2D.CanvasRenderer.prototype.start=function(){this.canvas.clear()};Grape2D.CanvasRenderer.prototype.end=function(){};Grape2D.CanvasRenderer.prototype.appendToDOMElement=function(a){this.canvas.appendOn(a)};Grape2D.CanvasRenderer.prototype.getDOMElement=function(){return this.canvas.canvas};Grape2D.CanvasRenderer.prototype.getContext=function(){return this.canvas.context};Grape2D.CanvasRenderer.prototype.setStrokeColor=function(a){this.canvas.setStrokeStyle(a)};
Grape2D.CanvasRenderer.prototype.setFillColor=function(a){this.canvas.setFillStyle(a)};Grape2D.WireframeRenderer=function(a){this.renderer=a};Grape2D.WireframeRenderer.prototype=Object.create(Grape2D.Renderer.prototype);Grape2D.WireframeRenderer.prototype.getWidth=function(){return this.renderer.getWidth()};Grape2D.WireframeRenderer.prototype.getHalfWidth=function(){return this.renderer.getHalfWidth()};Grape2D.WireframeRenderer.prototype.setWidth=function(a){this.renderer.setWidth(a)};
Grape2D.WireframeRenderer.prototype.getHeight=function(){return this.renderer.getHeight()};Grape2D.WireframeRenderer.prototype.getHalfHeight=function(){return this.renderer.getHalfHeight()};Grape2D.WireframeRenderer.prototype.setHeight=function(a){this.renderer.setHeight(a)};Grape2D.WireframeRenderer.prototype.renderTexture=function(a,b){this.renderer.renderTexture(a,b)};
Grape2D.WireframeRenderer.prototype.renderObject2D=function(a,b){var c=b.wcsToViewport(this,a.getPosition());this.renderer.canvas.fillRect(c.x,c.y,2,2);a.getBoundingBox().render(this,b)};Grape2D.WireframeRenderer.prototype.renderImage=function(a,b,c,d,f,e,g,h,k){this.renderer.renderImage(a,b,c,d,f,e,g,h,k)};Grape2D.WireframeRenderer.prototype.renderAABB=function(a,b){this.renderer.renderAABB(a,b)};Grape2D.WireframeRenderer.prototype.renderCircle=function(a,b){this.renderer.renderCircle(a,b)};
Grape2D.WireframeRenderer.prototype.renderPolygon=function(a,b){this.renderer.renderPolygon(a,b)};Grape2D.WireframeRenderer.prototype.renderText=function(a,b){this.renderer.renderText(a,b)};Grape2D.WireframeRenderer.prototype.start=function(){this.renderer.start()};Grape2D.WireframeRenderer.prototype.end=function(){this.renderer.end()};Grape2D.WireframeRenderer.prototype.appendToDOMElement=function(a){this.renderer.appendToDOMElement(a)};Grape2D.WireframeRenderer.prototype.getDOMElement=function(){return this.renderer.getDOMElement()};
Grape2D.WireframeRenderer.prototype.setStrokeColor=function(a){this.renderer.setStrokeColor(a)};Grape2D.WireframeRenderer.prototype.setFillColor=function(a){this.renderer.setFillColor(a)};Grape2D.InputManager=function(a){this.mouseUp=[];this.mouseDown=[];this.mouseMove=[];this.mouseOver=[];this.mouseOut=[];this.mouseWheel=[];this.resize=[];this.rendererBinding=a;this.bindToRenderer(a)};
Grape2D.InputManager.prototype={constructor:Grape2D.InputManager,bindToRenderer:function(a){this.rendererBinding=a;a=this.rendererBinding.getDOMElement();a.addEventListener("mouseup",Grape2D.InputManager.bindFn(this.rendererBinding,this.mouseUp),!1);a.addEventListener("mousedown",Grape2D.InputManager.bindFn(this.rendererBinding,this.mouseDown),!1);a.addEventListener("mousemove",Grape2D.InputManager.bindFn(this.rendererBinding,this.mouseMove),!1);a.addEventListener("mouseover",Grape2D.InputManager.bindFn(this.rendererBinding,
this.mouseOver),!1);a.addEventListener("mouseout",Grape2D.InputManager.bindFn(this.rendererBinding,this.mouseOut),!1);a.addEventListener("mousewheel",Grape2D.InputManager.bindFn(this.rendererBinding,this.mouseWheel),!1);a.addEventListener("resize",Grape2D.InputManager.bindFn(this.rendererBinding,this.resize),!1)},getMouseUpBindStack:function(){return this.mouseUp},addMouseUp:function(a){this.mouseUp.push(a)},removeMouseUp:function(a){1<=this.mouseUp.indexOf(a)&&this.mouseUp.splice(this.mouseUp.indexOf(a),
1)},getMouseDownBindStack:function(){return this.mouseDown},addMouseDown:function(a){this.mouseDown.push(a)},removeMouseDown:function(a){1<=this.mouseDown.indexOf(a)&&this.mouseDown.splice(this.mouseDown.indexOf(a),1)},getMouseMoveBindStack:function(){return this.mouseMove},addMouseMove:function(a){this.mouseMove.push(a)},removeMouseMove:function(a){1<=this.mouseMove.indexOf(a)&&this.mouseMove.splice(this.mouseMove.indexOf(a),1)},getMouseOverBindStack:function(){return this.mouseOver},addMouseOver:function(a){this.mouseOver.push(a)},
removeMouseOver:function(a){1<=this.mouseOver.indexOf(a)&&this.mouseOver.splice(this.mouseOver.indexOf(a),1)},getMouseOutBindStack:function(){return this.mouseOut},addMouseOut:function(a){this.mouseOut.push(a)},removeMouseOut:function(a){1<=this.mouseOut.indexOf(a)&&this.mouseOut.splice(this.mouseOut.indexOf(a),1)},getMouseWheelBindStack:function(){return this.mouseWheel},addMouseWheel:function(a){this.mouseWheel.push(a)},removeMouseWheel:function(a){1<=this.mouseWheel.indexOf(a)&&this.mouseWheel.splice(this.mouseWheel.indexOf(a),
1)},getResizeBindStack:function(){return this.resize},addResize:function(a){this.resize.push(a)},removeResize:function(a){1<=this.resize.indexOf(a)&&this.resize.splice(this.resize.indexOf(a),1)}};Grape2D.InputManager.bindFn=function(a,b){return function(c){var d=0;for(c=new Grape2D.InputManagerEvent(a,c);d<b.length;d++)b[d](c)}};Grape2D.InputManager.globalRegistry={keyDown:{},keyUp:{},keyPress:{}};Grape2D.InputManagerEvent=function(a,b){this.raw=b;this.bind=a};
Grape2D.InputManagerEvent.prototype={constructor:Grape2D.InputManagerEvent,getRaw:function(){return this.raw}};Grape2D.Camera=function(a){a=a||{};this.rscale=new Grape2D.Vector(1,1);this.scale=a.scale||new Grape2D.Vector(1,1);this.lookAt=a.lookAt||new Grape2D.Vector;this.transformation=a.transformation||new Grape2D.Matrix;this.cM=new Grape2D.Matrix;this.icM=new Grape2D.Matrix;this.computeMatrix()};
Grape2D.Camera.prototype={constructor:Grape2D.Camera,computeMatrix:function(){this.cM=this.transformation.clone();this.cM.v[0]*=this.scale.x*this.rscale.x;this.cM.v[1]*=this.scale.x*this.rscale.x;this.cM.v[2]*=this.scale.x*this.rscale.x;this.cM.v[3]*=this.scale.y*this.rscale.y;this.cM.v[4]*=this.scale.y*this.rscale.y;this.cM.v[5]*=this.scale.y*this.rscale.y;this.icM=this.cM.clone().invert()},wcsToViewport:function(a,b){var c=this.cM.multiplyByVector(b.clone().sub(this.lookAt));c.x+=a.getHalfWidth();
c.y+=a.getHalfHeight();return c},viewportToWcs:function(a,b){var c=b.clone();c.x-=a.getHalfWidth();c.y-=a.getHalfWidth();return c=this.icM.multiplyByVector(c).sub(this.lookAt)},rescale:function(a){this.rscale.x=a.x/this.scale.x;this.rscale.y=a.y/this.scale.y;this.computeMatrix()},setLookAt:function(a){this.lookAt.set(a)},getLookAt:function(){return this.lookAt},getScale:function(){return this.scale},computeShape:function(a){var b=(new Grape2D.Vector).set(this.lookAt),c=a.getWidth()/this.scale.x;a=
a.getHeight()/this.scale.y;return new Grape2D.AABB({position:b,width:c,height:a})}};Grape2D.AliasingCamera=function(a){Grape2D.Camera.call(this,a)};Grape2D.AliasingCamera.prototype=Object.create(Grape2D.Camera.prototype);Grape2D.AliasingCamera.prototype.wcsToViewport=function(a,b){return Grape2D.Camera.prototype.wcsToViewport.call(this,a,b).use(Grape2D.Math.floor)};Grape2D.Map=function(){};
Grape2D.Map.prototype={constructor:Grape2D.Map,add:function(a){},remove:function(a){},query:function(a){},queryPoint:function(a){},clear:function(){},update:function(a,b){}};Grape2D.SimpleMap=function(){this.objs=[]};Grape2D.SimpleMap.prototype=Object.create(Grape2D.Map);Grape2D.SimpleMap.prototype.add=function(a){this.objs.push(a)};Grape2D.SimpleMap.prototype.remove=function(a){this.objs.splice(this.objs.indexOf(a),1)};Grape2D.SimpleMap.prototype.query=function(a){return this.objs};
Grape2D.SimpleMap.prototype.queryPoint=function(a){return this.objs};Grape2D.SimpleMap.prototype.clear=function(){this.objs=[]};Grape2D.SimpleMap.prototype.update=function(a,b){for(var c=0;c<this.objs.length;c++)this.objs[c].update(a,b)};Grape2D.CollisionChecker=function(){};
Grape2D.CollisionChecker.prototype={constructor:Grape2D.CollisionChecker,aabbVsAabb:function(a,b){},aabbVsCircle:function(a,b){},aabbVsPolygon:function(a,b){},aabbVsPoint:function(a,b){},circleVsAabb:function(a,b){},circleVsCircle:function(a,b){},circleVsPolygon:function(a,b){},circleVsPoint:function(a,b){},polygonVsAabb:function(a,b){},polygonVsCircle:function(a,b){},polygonVsPolygon:function(a,b){},polygonVsPoint:function(a,b){}};Grape2D.GenericCollisionChecker=function(){};
Grape2D.GenericCollisionChecker.prototype=Object.create(Grape2D.CollisionChecker);Grape2D.GenericCollisionChecker.prototype.aabbVsAabb=function(a,b){return Grape2D.Math.abs(b.getPosition().getX()-a.getPosition().getX())<=a.getHalfWidth()+b.getHalfWidth()&&Grape2D.Math.abs(b.getPosition().getY()-a.getPosition().getY())<=a.getHalfHeight()+b.getHalfHeight()};
Grape2D.GenericCollisionChecker.prototype.aabbVsPoint=function(a,b){return Grape2D.Math.abs(a.getPosition().getX()-b.getX())<=a.getHalfWidth()&&Grape2D.Math.abs(a.getPosition().getY()-b.getY())<=a.getHalfHeight()};Grape2D.GenericCollisionChecker.prototype.circleVsAabb=function(a,b){return this.aabbVsCircle(b,a)};
Grape2D.GenericCollisionChecker.prototype.aabbVsCircle=function(a,b){var c=Grape2D.Math.clamp(b.getPosition().getX(),a.getPosition().getX()-a.getHalfWidth(),a.getPosition().getX()+a.getHalfWidth()),d=Grape2D.Math.clamp(b.getPosition().getY(),a.getPosition().getY()-a.getHalfWidth(),a.getPosition().getY()+a.getHalfWidth());return Grape2D.Math.sq(b.getPosition().getX()-c)+Grape2D.Math.sq(b.getPosition().getY()-d)>=Grape2D.Math.sq(b.getRadius())};
Grape2D.GenericCollisionChecker.prototype.circleVsCircle=function(a,b){return Grape2D.Math.sqrt(Grape2D.Math.sq(b.getPosition().getX()-a.getPosition().getX())+Grape2D.Math.sq(b.getPosition().getY()-a.getPosition().getY()))<=a.getRadius()+b.getRadius()};Grape2D.GenericCollisionChecker.prototype.circleVsPoint=function(a,b){return Grape2D.Math.sqrt(Grape2D.Math.sq(a.getPosition().getX()-b.getX())+Grape2D.Math.sq(a.getPosition().getY()-b.getY()))<=a.getRadius()};
Grape2D.GenericCollisionChecker.prototype.polygonVsAabb=function(a,b){return this.aabbVsPolygon(b,a)};Grape2D.GenericCollisionChecker.prototype.polygonVsCircle=function(a,b){return this.circleVsPolygon(b,a)};Grape2D.GenericCollisionChecker.prototype.aabbVsPolygon=function(a,b){return!1};Grape2D.GenericCollisionChecker.prototype.circleVsPolygon=function(a,b){for(var c=b.getVertexList(),d=a.getPosition(),f=Grape2D.Math.sq(a.getRadius()),e=0;e<c.length;e++)if(c[e].sqDistanceTo(d)<=f)return!1;return!0};
Grape2D.GenericCollisionChecker.prototype.polygonVsPolygon=function(a,b){return!1};Grape2D.GenericCollisionChecker.prototype.polygonVsPoint=function(a,b){var c=a.getVertexList(),d=[],f,e;d.push(c[0].clone().sub(b));for(f=0;f<d.length;++f)if(e=(f+1)%d.length,0<e&&d.push(c[e].clone().sub(b)),d[e].getX()*d[f].getY()-d[f].getX()*d[e].getY())return!1;return!0};Grape2D.SATCollisionChecker=function(){};Grape2D.SATCollisionChecker.prototype=Object.create(Grape2D.GenericCollisionChecker.prototype);
Grape2D.SATCollisionChecker.prototype.aabbVsPolygon=function(a,b){return!1};Grape2D.SATCollisionChecker.prototype.polygonVsPolygon=function(a,b){for(var c=this.selectAxis(this.computeAxis(a.getVertexList()),this.computeAxis(b.getVertexList())),d=this.computeIntervals(a.getVertexList(),c),f=this.computeIntervals(b.getVertexList(),c),e,g=0;g<c.length;g++)if(e=Grape2D.Math.overlaps(d,f),0>e)return!1;return!0};
Grape2D.SATCollisionChecker.prototype.computeAxis=function(a){var b=[];a=a.getVertexList();var c,d;for(d=0;d<a.length;d++)c=(d+1)%a.length,b.push(Grape2D.Vector.createFromPoints(a[d],a[c]).normalize().rightNormal());return b};Grape2D.SATCollisionChecker.prototype.selectAxis=function(a,b){for(var c=[],d,f=0;f<a.length;f++)c.push(a);f=0;for(d=!0;f<c.length;f++,d=!0){for(var e=0;e<b.length;e++)c[f].isParallelTo(b[e])&&(d=!1);d&&c.push(b[f])}return c};
Grape2D.SATCollisionChecker.prototype.computeIntervals=function(a,b){for(var c=[],d=Infinity,f=-Infinity,e,g,h=0;h<b.length;h++){for(var d=Infinity,f=-Infinity,k=0;k<a.length;k++)e=a[k].dot(b[h]),g=a[(k+1)%a.length].dot(b[h]),e>f&&(f=e),e<d&&(d=e),g>f&&(f=g),g<d&&(d=e);c.push({min:d,max:f})}return c};Grape2D.SATCollisionChecker.aabbAxis=[new Grape2D.Vector(1,0),new Grape2D.Vector(0,1)];
Grape2D.CollisionDispatcher={aabbVsAabb:function(a,b,c){return a.aabbVsAabb(b,c)},aabbVsCircle:function(a,b,c){return a.aabbVsCircle(b,c)},aabbVsPolygon:function(a,b,c){return a.aabbVsPolygon(b,c)},aabbVsPoint:function(a,b,c){return a.aabbVsPoint(b,c)},circleVsAabb:function(a,b,c){return a.circleVsAabb(b,c)},circleVsCircle:function(a,b,c){return a.circleVsCircle(b,c)},circleVsPolygon:function(a,b,c){return a.circleVsPolygon(b,c)},circleVsPoint:function(a,b,c){return a.circleVsPoint(b,c)},polygonVsAabb:function(a,
b,c){return a.polygonVsAabb(b,c)},polygonVsCircle:function(a,b,c){return a.polygonVsCircle(b,c)},polygonVsPolygon:function(a,b,c){return a.polygonVsPolygon(b,c)},polygonVsPoint:function(a,b,c){return a.polygonVsPoint(b,c)},dcache:{},dispatch:function(a,b,c){return Grape2D.CollisionDispatcher.dcache[b.getStaticType()][c.getStaticType()](a,b,c)}};
Grape2D.CollisionDispatcher.dcache={AABB:{AABB:Grape2D.CollisionDispatcher.aabbVsAabb,Circle:Grape2D.CollisionDispatcher.aabbVsCircle,Polygon:Grape2D.CollisionDispatcher.aabbVsPolygon,Point:Grape2D.CollisionDispatcher.aabbVsPoint},Circle:{AABB:Grape2D.CollisionDispatcher.circleVsAabb,Circle:Grape2D.CollisionDispatcher.circleVsCircle,Polygon:Grape2D.CollisionDispatcher.circleVsPolygon,Point:Grape2D.CollisionDispatcher.circleVsPoint},Polygon:{AABB:Grape2D.CollisionDispatcher.polygonVsAabb,Circle:Grape2D.CollisionDispatcher.polygonVsCircle,
Polygon:Grape2D.CollisionDispatcher.polygonVsPolygon,Point:Grape2D.CollisionDispatcher.polygonVsPoint}};Grape2D.CollisionCheckerSingleton={instance:new Grape2D.SATCollisionChecker,getCollisionChecker:function(){return Grape2D.CollisionCheckerSingleton.instance},setCollisionChecker:function(a){Grape2D.CollisionCheckerSingleton.instance=a},collide:function(a,b){return Grape2D.CollisionDispatcher.dispatch(Grape2D.CollisionCheckerSingleton.instance,a,b)}};Grape2D.BVHTree=function(){};
Grape2D.BVHTree.prototype=Object.create(Grape2D.Map.prototype);Grape2D.TopDownBVHTree=function(a){this.objs=a||[];this.rootNode=null;this.objs.length&&this.rebuild()};Grape2D.TopDownBVHTree.prototype=Object.create(Grape2D.BVHTree.prototype);Grape2D.TopDownBVHTree.prototype.rebuild=function(){this.rootNode=new Grape2D.TopDownBVHNode(null,this.objs)};Grape2D.TopDownBVHTree.prototype.add=function(a){this.objs.push(a)};
Grape2D.TopDownBVHTree.prototype.remove=function(a){this.objs.splice(this.objs.indexOf(a),1)};Grape2D.TopDownBVHTree.prototype.query=function(a){return this.rootNode.query(a)};Grape2D.TopDownBVHTree.prototype.queryPoint=function(a){return this.rootNode.queryPoint(a)};Grape2D.TopDownBVHTree.prototype.clear=function(){this.objs=[];this.rootNode=null};Grape2D.TopDownBVHTree.prototype.update=function(a,b){for(var c=0;c<this.objs.length;c++)this.objs[c].update(a,b)};Grape2D.TopDownBVHTree.MAX_DEPTH=50;
Grape2D.TopDownBVHTree.DEFAULT_PER_LEAF=2;Grape2D.TopDownBVHNode=function(a,b){this.bv=Grape2D.BVFactorySingleton.getPlaceHolder();this.leaf=!1;this.objects=[];this.parent=a;this.right=this.left=null;this.depth=a?a.getDepth()+1:0;this.compute(b)};
Grape2D.TopDownBVHNode.prototype={constructor:Grape2D.TopDownBVHNode,compute:function(a){if(a.length<=Grape2D.TopDownBVHTree.DEFAULT_PER_LEAF||this.depth>=Grape2D.TopDownBVHTree.MAX_DEPTH){this.leaf=!0;for(var b=0;b<a.length;b++)this.objects.push(a[b])}else{var c=Grape2D.BVHStrategySingleton.getStrategy().solve(a),d=Grape2D.BVFactorySingleton.getFactory();this.bv=d.merge(a[0].getBoundingBox(),a[1].getBoundingBox());for(b=2;b<a.length;b++)this.bv=d.merge(this.bv,a[b].getBoundingBox());this.left=new Grape2D.TopDownBVHNode(this,
c.left);this.right=new Grape2D.TopDownBVHNode(this,c.right)}},isLeaf:function(){return this.leaf},getBoundingVolume:function(){return this.bv},getParent:function(){return this.parent},getObjects:function(){return this.objects},getLeft:function(){return this.left},getRight:function(){return this.left},query:function(a){var b=[],c;if(this.leaf)for(c=0;c<this.objects.length;c++)Grape2D.CollisionCheckerSingleton.collide(a,this.objects[c].getBoundingBox())&&b.push(this.objects[c]);else if(Grape2D.CollisionCheckerSingleton.collide(a,
this.bv)){var d=this.left.query(a);for(c=0;c<d.length;c++)b.push(d[c]);d=this.right.query(a);for(c=0;c<d.length;c++)b.push(d[c])}return b},getDepth:function(){return this.depth}};Grape2D.BVHStrategy=function(){};Grape2D.BVHStrategy.prototype={constructor:Grape2D.BVHStrategy,solve:function(a){}};Grape2D.MedianCutBVHStrategy=function(){};Grape2D.MedianCutBVHStrategy.prototype=Object.create(Grape2D.BVHStrategy.prototype);
Grape2D.MedianCutBVHStrategy.prototype.solve=function(a){for(var b={left:[],right:[]},c=Infinity,d=-Infinity,f=Infinity,e=-Infinity,g=0,h,k=0;k<a.length;k++)h=a[k].getBoundingBoxPosition(),c>h.getX()&&(c=h.getX()),d<h.getX()&&(d=h.getX()),f>h.getY()&&(f=h.getY()),e<h.getY()&&(e=h.getY());if(c+d>=f+e)for(g=(d+c)/2,k=0;k<a.length;k++)h=a[k].getBoundingBoxPosition(),h.getX()>g?b.right.push(a[k]):b.left.push(a[k]);else for(g=(e+f)/2,k=0;k<a.length;k++)h=a[k].getBoundingBoxPosition(),h.getY()>g?b.right.push(a[k]):
b.left.push(a[k]);return b};Grape2D.BVHStrategySingleton={strategy:new Grape2D.MedianCutBVHStrategy,setStrategy:function(a){Grape2D.BVHStrategySingleton.strategy=a},getStrategy:function(){return Grape2D.BVHStrategySingleton.strategy}};Grape2D.BVFactory=function(){};Grape2D.BVFactory.prototype={constructor:Grape2D.BVFactory,createFromAABB:function(a){},createFromCircle:function(a){},createFromPolygon:function(a){},createSceneBV:function(a,b){},getPlaceHolder:function(){}};Grape2D.AabbBVFactory=function(){};
Grape2D.AabbBVFactory.prototype=Object.create(Grape2D.BVFactory.prototype);Grape2D.AabbBVFactory.prototype.createFromAABB=function(a){return a};Grape2D.AabbBVFactory.prototype.createFromCircle=function(a){var b=2*a.getRadius();return new Grape2D.AABB({position:a.getPosition(),width:b,height:b})};
Grape2D.AabbBVFactory.prototype.createFromPolygon=function(a){var b=Infinity,c=-Infinity,d=Infinity,f=-Infinity;a=a.getVertexList();for(var e,g=0;g<a.length;g++)e=a[g],b>e.getX()&&(b=e.getX()),c<e.getX()&&(c=e.getX()),d>e.getY()&&(d=e.getY()),c<e.getY()&&(f=e.getY());b=c-b;d=f-d;return new Grape2D.AABB({position:new Grape2D.Vector(b/2+b,d/2+d),width:b,height:d})};
Grape2D.AabbBVFactory.prototype.createSceneBV=function(a,b){return new Grape2D.AABB({position:b.getLookAt(),width:a.getWidth()/b.getScale().getX(),height:a.getHeight()/b.getScale().getY()})};
Grape2D.AabbBVFactory.prototype.merge=function(a,b){var c=b.getPosition().getX()-a.getPosition().getX(),d=b.getPosition().getY()-a.getPosition().getY(),f,e=new Grape2D.Vector;Grape2D.Math.abs(c)+b.getHalfWidth()<=a.getHalfWidth()?(c=a.getWidth(),e.setX(a.getPosition().getX())):(c=Grape2D.Math.abs(c)+b.getHalfWidth()+a.getHalfWidth(),f=a.getPosition().getX()>=b.getPosition().getX()?a.getPosition().getX()+a.getHalfWidth()-c/2:a.getPosition().getX()-a.getHalfWidth()+c/2,e.setX(f));Grape2D.Math.abs(d)+
b.getHalfHeight()<=a.getHalfHeight()?(d=a.getHeight(),e.setY(a.getPosition().getY())):(d=Grape2D.Math.abs(d)+b.getHalfHeight()+a.getHalfHeight(),f=a.getPosition().getY()>=b.getPosition().getY()?a.getPosition().getY()+a.getHalfHeight()-d/2:a.getPosition().getY()-a.getHalfHeight()+d/2,e.setY(f));return new Grape2D.AABB({width:c,height:d,position:e})};Grape2D.AabbBVFactory.prototype.getPlaceHolder=function(){return Grape2D.AabbBVFactory.PLACE_HOLDER};
Grape2D.AabbBVFactory.PLACE_HOLDER=new Grape2D.AABB({width:0,height:0});Grape2D.BVFactorySingleton={bvfactory:new Grape2D.AabbBVFactory,getFactory:function(){return Grape2D.BVFactorySingleton.bvfactory},setFactory:function(a){Grape2D.BVFactorySingleton.bvfactory=a},create:function(a){return a.createBV(Grape2D.BVFactorySingleton.bvfactory)},getPlaceHolder:function(){return Grape2D.BVFactorySingleton.bvfactory.getPlaceHolder()}};Grape2D.ITexture=function(){};
Grape2D.ITexture.prototype={constructor:Grape2D.ITexture,getWidth:function(){},getHalfWidth:function(){},setWidth:function(a){},getHeight:function(){},getHalfHeight:function(){},setHeight:function(a){},render:function(a,b){}};Grape2D.Texture=function(a){a=a||{};this.width=2;this.hwidth=1;this.height=2;this.hheight=1;this.buffer=new Grape2D.CanvasRenderer;a.image?this.bufferImage(a.image):a.useTexure&&(this.buffer=a.useTexure)};Grape2D.Texture.prototype=Object.create(Grape2D.ITexture);
Grape2D.Texture.prototype.getWidth=function(){return this.width};Grape2D.Texture.prototype.getHeight=function(){return this.height};Grape2D.Texture.prototype.setWidth=function(a){this.width=a;this.hwidth=this.width/2};Grape2D.Texture.prototype.setHeight=function(a){this.height=a;this.hheight=this.height/2};Grape2D.Texture.prototype.getHalfWidth=function(){return this.hwidth};Grape2D.Texture.prototype.getHalfHeight=function(){return this.hheight};Grape2D.Texture.prototype.getBuffer=function(){return this.buffer.canvas.canvas};
Grape2D.Texture.prototype.bufferImage=function(a){this.setWidth(a.width);this.setHeight(a.height);this.buffer=new Grape2D.CanvasRenderer;this.buffer.renderImage(a,0,0,this.width,this.height,0,0,this.width,this.height)};Grape2D.Texture.prototype.render=function(a,b){a.renderTexture(this,b)};Grape2D.Texture.createFromImage=function(a,b){var c=new Image,d=new Grape2D.Texture;c.onload=function(a){d.bufferImage(this);b&&b(d,this,a)};c.src=a;return d};Grape2D.VoidTexture=function(){};
Grape2D.VoidTexture.prototype=Object.create(Grape2D.ITexture);Grape2D.VoidTexture.prototype.getWidth=function(){return 0};Grape2D.VoidTexture.prototype.getHalfWidth=function(){return 0};Grape2D.VoidTexture.prototype.setWidth=function(a){};Grape2D.VoidTexture.prototype.getHeight=function(){return 0};Grape2D.VoidTexture.prototype.getHalfHeight=function(){return 0};Grape2D.VoidTexture.prototype.setHeight=function(a){};Grape2D.VoidTexture.prototype.render=function(){};
Grape2D.Object2D=function(a){this.position=a.position||new Grape2D.Vector;this.visible=a.visible||!0;this.texture=a.texture;this.textureOffset=a.textureOffset||new Grape2D.Vector;this.texturePosition=new Grape2D.Vector;this.computeTexturePosition();this.boundingBox=a.boundingBox;this.boundingBoxOffset=a.boundingBoxOffset||new Grape2D.Vector;this.computeBoundingBoxPosition();this.castShadow=a.castShadow||!1;this.receiveLight=a.receiveLight||!1};
Grape2D.Object2D.prototype={constructor:Grape2D.Object2D,isVisible:function(){return this.visible},setVisible:function(a){this.visible=a},getTexture:function(){return this.texture},setTexture:function(a){this.texture=a},getBoundingBox:function(){return this.boundingBox},setBoundingBox:function(a){this.boundingBox=a;this.computeBoundingBoxPosition()},canCastShadow:function(){return this.castShadow},setCastShadow:function(a){this.castShadow=a},canReceiveLight:function(){return this.receiveLight},setReceiveLight:function(a){this.receiveLight=
a},getPosition:function(){return this.position},setPosition:function(a){this.position.set(a);this.computeBoundingBoxPosition();this.computeTexturePosition()},setTextureOffset:function(a){this.textureOffset.set(a);this.computeTexturePosition()},getTextureOffset:function(){return this.textureOffset},setBoundingBoxOffset:function(a){this.boundingBoxOffset.set(a);this.computeBoundingBoxPosition()},getBoundingBoxOffset:function(){return this.boundingBoxOffset},computeBoundingBoxPosition:function(){this.boundingBox.setPosition(this.position);
this.boundingBox.getPosition().add(this.boundingBoxOffset)},getBoundingBoxPosition:function(){return this.boundingBox.getPosition()},computeTexturePosition:function(){this.texturePosition.set(this.position).add(this.textureOffset)},getTexturePosition:function(){return this.texturePosition},render:function(a,b){a.renderObject2D(this,b)},update:function(a,b){}};Grape2D.Shape=function(a){a=a||{};this.position=a.position||new Grape2D.Vector};
Grape2D.Shape.prototype={constructor:Grape2D.Shape,getPosition:function(){return this.position},setPosition:function(a){this.position.set(a)},render:function(a,b){},createBV:function(a){},getStaticType:function(){}};Grape2D.AABB=function(a){Grape2D.Shape.call(this,a);this.width=a.width;this.hwidth=this.width/2;this.height=a.height;this.hheight=this.height/2};Grape2D.AABB.prototype=Object.create(Grape2D.Shape.prototype);Grape2D.AABB.prototype.getWidth=function(){return this.width};
Grape2D.AABB.prototype.getHeight=function(){return this.height};Grape2D.AABB.prototype.getHalfWidth=function(){return this.hwidth};Grape2D.AABB.prototype.getHalfHeight=function(){return this.hheight};Grape2D.AABB.prototype.setWidth=function(a){this.width=a;this.hwidth=this.width/2};Grape2D.AABB.prototype.setHeight=function(a){this.hheight=this.height=a};Grape2D.AABB.prototype.render=function(a,b){a.renderAABB(this,b)};Grape2D.AABB.prototype.createBV=function(a){return a.createFromAABB(this)};
Grape2D.AABB.prototype.getStaticType=function(){return Grape2D.AABB.TYPE};Grape2D.AABB.TYPE="AABB";Grape2D.Circle=function(a){Grape2D.Shape.call(this,a);this.radius=a.radius};Grape2D.Circle.prototype=Object.create(Grape2D.Shape.prototype);Grape2D.Circle.prototype.getRadius=function(){return this.radius};Grape2D.Circle.prototype.setRadius=function(a){this.radius=a};Grape2D.Circle.prototype.render=function(a,b){a.renderCircle(this,b)};Grape2D.Circle.prototype.createBV=function(a){return a.createFromCircle(this)};
Grape2D.Circle.prototype.getStaticType=function(){return Grape2D.Circle.TYPE};Grape2D.Circle.TYPE="Circle";Grape2D.Polygon=function(a){Grape2D.Shape.call(this,a);this.vertexList=a.vertexList};Grape2D.Polygon.prototype=Object.create(Grape2D.Shape.prototype);Grape2D.Polygon.prototype.getVertexList=function(){return this.vertexList};Grape2D.Polygon.prototype.setVertexList=function(a){this.vertexList=a};Grape2D.Polygon.prototype.render=function(a,b){a.renderPolygon(this,b)};
Grape2D.Polygon.prototype.createBV=function(a){return a.createFromPolygon(this)};Grape2D.Polygon.prototype.getStaticType=function(){return Grape2D.Polygon.TYPE};Grape2D.Polygon.TYPE="Polygon";Grape2D.Scene=function(){};Grape2D.Scene.prototype={constructor:Grape2D.Scene,update:function(a){},render:function(a,b){}};Grape2D.SceneGroup=function(){this.childs=[]};Grape2D.SceneGroup.prototype=Object.create(Grape2D.Scene.prototype);Grape2D.SceneGroup.prototype.update=function(a){for(var b=0;b<this.childs.length;b++)this.childs[b].update(a)};
Grape2D.SceneGroup.prototype.render=function(a,b){for(var c=0;c<this.childs.length;c++)this.childs[c].render(a,b)};Grape2D.SceneGroup.prototype.addChild=function(a){this.childs.push(a)};Grape2D.SceneGroup.prototype.removeChild=function(a){this.childs.splice(this.childs.indexOf(a),1)};Grape2D.SceneLayer=function(a){a=a||{};this.map=a.map||new Grape2D.SimpleMap};Grape2D.SceneLayer.prototype=Object.create(Grape2D.Scene.prototype);Grape2D.SceneLayer.prototype.update=function(a){this.map.update(a)};
Grape2D.SceneLayer.prototype.render=function(a,b){var c=this.map.query(Grape2D.BVFactorySingleton.getFactory().createSceneBV(a,b));a.start();for(var d=0;d<c.length;d++)c[d].render(a,b);a.end()};Grape2D.SceneLayer.prototype.getMap=function(){return this.map};Grape2D.Game=function(){};Grape2D.Game.prototype={constructor:Grape2D.Game,setup:function(){},start:function(){},stop:function(){},render:function(){},update:function(a){},animate:function(){}};
Grape2D.SimpleGame=function(a,b,c){this.camera=c;this.clock=new Grape2D.utils.Clock;this.renderer=a;this.scene=b};Grape2D.SimpleGame.prototype=Object.create(Grape2D.Game.prototype);Grape2D.SimpleGame.prototype.getCamera=function(){return this.camera};Grape2D.SimpleGame.prototype.getClock=function(){return this.clock};Grape2D.SimpleGame.prototype.getRenderer=function(){return this.renderer};Grape2D.SimpleGame.prototype.getScene=function(){return this.scene};Grape2D.SimpleGame.prototype.setup=function(){};
Grape2D.SimpleGame.prototype.start=function(){this.animate()};Grape2D.SimpleGame.prototype.stop=function(){};Grape2D.SimpleGame.prototype.render=function(){this.scene.render(this.renderer,this.camera)};Grape2D.SimpleGame.prototype.update=function(a){this.scene.update(a)};Grape2D.SimpleGame.prototype.animate=function(){var a=this;webkitRequestAnimationFrame(function(){a.animate()});this.update(this.clock.update());this.render()};
